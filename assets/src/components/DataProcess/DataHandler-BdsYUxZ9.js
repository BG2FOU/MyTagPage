import{_ as h}from"./GeoJSONConverter-ClO_YRNt.js";import{s as S}from"../stores/serverStore-BTgB0R_e.js";import{r,b,w as A,a as T,o as j,E as f}from"../../../vendor-UN2rW63P.js";const k={__name:"DataHandler",props:{payload:{type:Object,default:{}}},setup(x,{expose:m}){const d=S(),o=r(null),v=r(!0),l=r(),i=r(null),s=r(""),g=e=>{const a=new TextEncoder().encode(e),t=Array.from(a,n=>String.fromCharCode(n)).join("");return btoa(t)},y=async e=>{const a={idArray:e.idSelected,dateTimeRange:{start:e.dateTimeRange[0],end:e.dateTimeRange[1]},mode:e.mode};try{const t=d.serverAddress;t&&(s.value=t);const n=JSON.stringify(a),p=g(n),u=await fetch(s.value,{method:"POST",headers:{"Content-Type":"application/json","X-Data-Encoding":"base64"},body:JSON.stringify({data:p})}).then(async c=>{if(!c.ok){const _=await c.text();throw new Error(_)}return c.json()});return l.value=u,u}catch(t){throw console.error("请求异常:",t),s.value?f.error(`数据获取失败: ${t}`):f.error("请设置服务器地址"),t}finally{v.value=!1}};return b(async()=>{const e=localStorage.getItem("serverAddress");e?(d.serverAddress=e,s.value=e):console.warn("No server address found in localStorage"),A(()=>{var a;return(a=o.value)==null?void 0:a.geoJsonData},a=>{a&&(i.value=o.value.geoJsonData)},{immediate:!0})}),m({fetchData:y,exposedData:i}),(e,a)=>(j(),T(h,{data:l.value,ref_key:"Geojsondata",ref:o},null,8,["data"]))}};export{k as _};
