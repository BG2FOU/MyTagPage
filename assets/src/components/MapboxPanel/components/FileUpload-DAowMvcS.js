import{r as c,g as w,b as M,h as W,i as v,d as y,o as h,e as s,j as t,l as u,k as l,z as O,p as T,I as U,t as f,F as $,E as N,m as A}from"../../../../vendor-UN2rW63P.js";import{_ as I}from"../../../../plugin-vue_export-helper-DlAUqK2U.js";const L={class:"responsive-container"},R={class:"upload-section"},K={class:"upload-section"},q={key:0,class:"preview-section"},G={class:"preview-container"},H={class:"preview-stats"},P={key:1,class:"error-message"},Q={class:"dialog-footer"},X={__name:"FileUpload",emits:["json-parsed"],setup(Y,{emit:B}){const d=c(!1),o=c([]),a=c(""),_=c(0),m=c(window.innerWidth),C=w(()=>m.value<768?"90%":m.value<1024?"80%":"600px"),S=w(()=>m.value<768?2:3),x=()=>{m.value=window.innerWidth};M(()=>{window.addEventListener("resize",x)}),W(()=>{window.removeEventListener("resize",x)});const k=w(()=>o.value.slice(0,S.value)),j=B,b=n=>{if(a.value="",!n.raw.type.includes("json")&&!n.name.endsWith(".json"))return a.value="请上传有效的JSON文件",!1;if(n.size>5*1024*1024)return a.value="文件大小超过5MB限制",!1;_.value+=n.size;const e=new FileReader;return e.onload=i=>{try{const r=JSON.parse(i.target.result),p=Array.isArray(r)?r:[r];o.value=[...o.value,...p],N.success(`成功解析${p.length}条数据`)}catch(r){a.value=`JSON解析失败: ${r.message}`,console.error("JSON解析错误",r)}},e.onerror=()=>{a.value="文件读取失败，请重试"},e.readAsText(n.raw),!0},F=()=>{o.value.length&&(j("json-parsed",JSON.parse(JSON.stringify(o.value))),d.value=!1,V(),N.success("数据已保存"))},J=()=>{o.value=[],a.value="",_.value=0,N.info("已重置解析数据")},V=()=>{o.value=[],a.value="",_.value=0},z=n=>{o.value.length?A.confirm("确定关闭窗口吗？未提交的数据将丢失","确认关闭",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{J(),n()}).catch(()=>{}):n()};return(n,e)=>{const i=v("el-button"),r=v("el-icon"),p=v("el-upload"),D=v("el-alert"),E=v("el-dialog");return h(),y($,null,[s(i,{type:"primary",onClick:e[0]||(e[0]=g=>d.value=!0)},{default:t(()=>e[3]||(e[3]=[u(" 解析JSON密钥文件 ")])),_:1,__:[3]}),s(E,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=g=>d.value=g),draggable:"",title:"JSON文件解析",width:C.value,"before-close":z,"destroy-on-close":"",class:"json-dialog"},{footer:t(()=>[l("div",Q,[s(i,{onClick:J},{default:t(()=>e[8]||(e[8]=[u("重置")])),_:1,__:[8]}),s(i,{onClick:e[1]||(e[1]=g=>d.value=!1)},{default:t(()=>e[9]||(e[9]=[u("取消")])),_:1,__:[9]}),s(i,{type:"primary",disabled:!o.value.length,onClick:F},{default:t(()=>e[10]||(e[10]=[u(" 确认使用数据 ")])),_:1,__:[10]},8,["disabled"])])]),default:t(()=>[l("div",L,[l("div",R,[s(p,{class:"upload-demo",drag:"",multiple:"","auto-upload":!1,"on-change":b,accept:".json"},{tip:t(()=>e[4]||(e[4]=[l("div",{class:"el-upload__tip"}," 仅支持JSON格式文件（最大5MB） ",-1)])),default:t(()=>[s(r,{class:"el-icon--upload"},{default:t(()=>[s(T(U))]),_:1}),e[5]||(e[5]=l("div",{class:"el-upload__text"},[u(" 拖拽JSON文件到此处或"),l("em",null,"点击上传")],-1))]),_:1,__:[5]})]),l("div",K,[s(p,{class:"upload-demo",multiple:"","auto-upload":!1,"on-change":b,accept:".json"},{trigger:t(()=>[s(i,{type:"primary",class:"full-width-btn"},{default:t(()=>e[6]||(e[6]=[u("选择JSON文件")])),_:1,__:[6]})]),tip:t(()=>e[7]||(e[7]=[l("div",{class:"el-upload__tip"}," 支持多文件选择 ",-1)])),_:1})])]),o.value.length>0?(h(),y("div",q,[l("h4",null,"解析结果预览 (前"+f(S.value)+"条数据):",1),l("div",G,[l("pre",null,f(k.value),1)]),l("div",H," 已解析: "+f(o.value.length)+" 条数据 | 文件大小: "+f((_.value/1024).toFixed(2))+" KB ",1)])):O("",!0),a.value?(h(),y("div",P,[s(D,{title:a.value,type:"error","show-icon":"",closable:!0},null,8,["title"])])):O("",!0)]),_:1},8,["modelValue","width"])],64)}}},te=I(X,[["__scopeId","data-v-a44891f9"]]);export{te as F};
